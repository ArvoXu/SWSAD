:root{
  --grid-columns: 9;
  --grid-rows: 5; /* ensure 9x5 */
  --gutter: 12px;
  --panel-padding: 16px;
  --card-radius: 12px;
}
*{box-sizing:border-box}
body{font-family: 'Microsoft JhengHei',sans-serif; background:#eef6ff; margin:0;}
.page-wrap{display:flex; padding:48px; justify-content:center;}

.content-wrapper{
    display:flex;
    width:100%;
    max-width:1400px;
}

.sidebar{
    width:160px;
    background:rgba(255,255,255,0.9);
    border-radius:12px;
    padding:20px;
    box-shadow:0 6px 24px rgba(0,0,0,0.08);
    margin-right:24px;
    display:flex;
    flex-direction:column;
}
.logo{font-weight:700; font-size:18px; margin-bottom:24px}
.side-nav{display:flex; flex-direction:column; gap:16px; flex:1}
.nav-item{padding:8px 12px; border-radius:8px; cursor:pointer; transition:background 0.2s}
.nav-item:hover{background:rgba(33,150,243,0.1)}
.user{margin-top:auto; font-size:14px; color:#666}

.dashboard{flex:1}
.dashboard-inner{
  background:rgba(255,255,255,0.95);
  border-radius:16px;
  padding:24px;
  box-shadow:0 10px 40px rgba(20,40,80,0.06);
  display:flex;
  flex-direction:column;
  /* Use available viewport with symmetric vertical padding inside */
  min-height: calc(60vh);
  max-height: calc(100vh - 96px);
  overflow:auto;
}

.main-content{
  /* center header + grid vertically with symmetric top/bottom space */
  display:flex;
  flex-direction:column;
  align-items:stretch;
  justify-content:center;
  padding-top:24px;
  padding-bottom:24px;
}

.dashboard-header{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px}
.dashboard-header h1{font-size:20px}

/* toolbox in header (right aligned, compact) */
.toolbox{position:relative; display:flex; align-items:center}
.toolbox-button{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer}
.toolbox-button svg{display:block}
.toolbox-panel{position:absolute; right:0; top:40px; width:260px; background:rgba(255,255,255,0.98); border-radius:10px; box-shadow:0 8px 30px rgba(10,30,60,0.12); padding:10px; z-index:12000}
.toolbox-group{margin-bottom:8px}
.group-title{font-size:12px;font-weight:700;color:#333;margin-bottom:6px}
.toolbox-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
.toolbox-item{padding:8px 10px;border-radius:8px;background:linear-gradient(180deg,#fff,#f6fbff);cursor:grab;display:flex;justify-content:space-between;align-items:center;font-size:13px;border:1px solid rgba(33,150,243,0.06)}
.toolbox-item:active,.toolbox-item.dragging{opacity:0.8}
.toolbox-item .icon{margin-left:8px;opacity:0.8}

/* trash bin that appears at bottom while dragging */
.trash-bin{position:fixed; left:50%; transform:translateX(-50%); bottom:18px; width:120px; height:56px; background:rgba(255,255,255,0.98); border-radius:999px; display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(0,0,0,0.12); z-index:13000; opacity:0; pointer-events:none; transition:opacity 160ms ease}
.trash-bin.visible{opacity:1; pointer-events:auto}
.trash-bin .icon{font-size:22px}
.trash-bin.drag-over{background:linear-gradient(90deg,#ffebee,#ffcdd2)}

.grid-area{position:relative; width:100%; background:transparent}

/* Keep a responsive max-height so grid doesn't push footer/header off-screen */
.grid-area-inner{
  width:100%;
  height:0;
  padding-bottom:56.25%; /* 16:9 fallback */
  position:relative;
}

/* place overlay absolute inside grid-area */
.grid-area > .grid-overlay{position:absolute; inset:0;}

/* base grid for 9x5 */
.grid-overlay{position:absolute; inset:0; display:grid; grid-template-columns: repeat(var(--grid-columns), 1fr); grid-template-rows: repeat(var(--grid-rows), 1fr); gap:var(--gutter); pointer-events:none;}
.grid-overlay::before{content:''; position:absolute; inset:0; border-radius:12px;}
.grid-overlay .cell{border:1px dashed rgba(33,150,243,0.08);}

.module{position:absolute; background:linear-gradient(180deg,#fff,#f7fbff); border-radius:var(--card-radius); box-shadow:0 6px 24px rgba(10,30,60,0.06); padding:8px; overflow:hidden; display:flex; flex-direction:column;}
.module-header{font-weight:600; padding:6px 8px; height:32px}
.module-body{flex:1; padding:8px; min-height:0; display:flex; align-items:center; justify-content:center}
.module canvas{width:100% !important; height:100% !important; max-height:100%}

/* KPI specific */
.kpi-module { display:flex; flex-direction:column; justify-content:center; }
.kpi-value { font-size:24px; font-weight:700; color:var(--primary-color, #2196F3) }

.resize-handle{width:18px; height:18px; position:absolute; right:6px; bottom:6px; background:linear-gradient(135deg,#2196F3,#673AB7); border-radius:4px; cursor:se-resize; opacity:0.9}

/* overlay visible while dragging/resizing */
.grid-overlay.visible{background:rgba(0,0,0,0.00)}
.grid-overlay .cell.visible{background:rgba(33,150,243,0.12); border-color:rgba(33,150,243,0.22)}

/* Smooth dragging visuals: follow pointer using pixel positions and slightly elevate module */
.module.dragging{
  transition: transform 0.06s linear; /* keep immediate follow for left/top while dragging */
  transform: translateZ(0);
  z-index: 12999; /* just below trash while dragging */
  box-shadow: 0 22px 48px rgba(10,30,60,0.18);
  pointer-events: auto;
  will-change: left, top, transform;
}

/* while dragging allow pointer to move over overlay (overlay pointer-events none by default) */
.grid-overlay{pointer-events:none}

/* snapping animation when applying grid-aligned final position */
.module.snapping{
  transition: left 220ms cubic-bezier(.2,.9,.2,1), top 220ms cubic-bezier(.2,.9,.2,1), width 220ms cubic-bezier(.2,.9,.2,1), height 220ms cubic-bezier(.2,.9,.2,1), box-shadow 220ms ease;
  z-index: 10000; /* still above normal modules while animating */
}

/* when module is temporarily fixed on body, ensure it appears above everything */
.module[style*="position: fixed"]{
  z-index: 12999;
  pointer-events: auto;
}

/* spacing from page edges to create floating effect */
.page-wrap{padding:48px}

/* module gap enforcement via internal margin */
.module{padding:12px}

/* small screens */
@media(max-width:900px){
  .page-wrap{padding:18px}
  .sidebar{display:none}
  .dashboard-inner{padding:12px}
  .main-content{padding-top:12px; padding-bottom:12px}
  .module{padding:8px}
  .kpi-value{font-size:18px}
}

@media(max-width:600px){
  .content-wrapper{flex-direction:column}
  .sidebar{display:none}
  .page-wrap{padding:12px}
  .dashboard-inner{padding:10px}
  .dashboard-header h1{font-size:16px}
  .module-header{font-size:13px}
}

